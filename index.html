<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Assistente de Estacionamento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      background-color: #f0f4f8;
    }
    
    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    #header {
      background: linear-gradient(135deg, #3a7bd5, #00d2ff);
      color: white;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 10;
    }
    
    #map-container {
      position: relative;
      flex-grow: 1;
      overflow: hidden;
    }
    
    #map {
      height: 100%;
      width: 100%;
    }
    
    #controls {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.5rem;
      z-index: 100;
    }
    
    .control-btn {
      background: white;
      border: none;
      border-radius: 50%;
      width: 3.5rem;
      height: 3.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .control-btn:active {
      transform: scale(0.95);
    }
    
    .control-btn svg {
      width: 1.5rem;
      height: 1.5rem;
    }
    
    #info-panel {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: white;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 15px rgba(0,0,0,0.15);
      max-width: 80%;
      z-index: 100;
      transition: transform 0.3s ease;
    }
    
    #info-panel.hidden {
      transform: translateX(-110%);
    }
    
    #info-toggle {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: white;
      border: none;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 99;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    #info-toggle.visible {
      opacity: 1;
    }
    
    .car-dimensions {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    
    .dimension-input {
      flex: 1;
    }
    
    .dimension-input label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 0.25rem;
      color: #555;
    }
    
    .dimension-input input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 0.25rem;
    }
    
    #apply-dimensions {
      background: #3a7bd5;
      color: white;
      border: none;
      border-radius: 0.25rem;
      padding: 0.5rem 1rem;
      margin-top: 0.5rem;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
    }
    
    #apply-dimensions:hover {
      background: #2a6ac5;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 0.25rem;
      background: #f0f0f0;
    }
    
    .status-dot {
      width: 0.75rem;
      height: 0.75rem;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    
    .status-text {
      font-size: 0.9rem;
    }
    
    .status-perfect .status-dot {
      background: #4CAF50;
    }
    
    .status-good .status-dot {
      background: #2196F3;
    }
    
    .status-adjust .status-dot {
      background: #FF9800;
    }
    
    .status-warning .status-dot {
      background: #F44336;
    }
    
    .status-perfect {
      background: rgba(76, 175, 80, 0.1);
    }
    
    .status-good {
      background: rgba(33, 150, 243, 0.1);
    }
    
    .status-adjust {
      background: rgba(255, 152, 0, 0.1);
    }
    
    .status-warning {
      background: rgba(244, 67, 54, 0.1);
    }
    
    #compass {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      background: white;
      border-radius: 50%;
      width: 3rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 100;
    }
    
    #compass-needle {
      width: 1.5rem;
      height: 1.5rem;
      transform-origin: center;
      transition: transform 0.2s ease;
    }
    
    @media (max-width: 768px) {
      #info-panel {
        max-width: 90%;
      }
      
      .car-dimensions {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <header id="header">
      <h1>Assistente de Estacionamento</h1>
    </header>
    
    <div id="map-container">
      <div id="map"></div>
      
      <div id="info-panel">
        <h2>Configurações</h2>
        <p>Ajuste as dimensões do seu veículo para melhor precisão:</p>
        
        <div class="car-dimensions">
          <div class="dimension-input">
            <label for="car-length">Comprimento (m)</label>
            <input type="number" id="car-length" value="4.5" min="2" max="10" step="0.1">
          </div>
          <div class="dimension-input">
            <label for="car-width">Largura (m)</label>
            <input type="number" id="car-width" value="2.0" min="1" max="5" step="0.1">
          </div>
        </div>
        
        <button id="apply-dimensions">Aplicar Dimensões</button>
        
        <div class="status-indicator status-adjust">
          <div class="status-dot"></div>
          <div class="status-text">Posicione seu veículo na vaga</div>
        </div>
        
        <div style="margin-top: 1rem;">
          <small>Use os botões abaixo para ajustar a posição da vaga</small>
        </div>
      </div>
      
      <button id="info-toggle" class="hidden">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </button>
      
      <div id="controls">
        <button class="control-btn" id="move-up">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#3a7bd5">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
          </svg>
        </button>
        <button class="control-btn" id="move-left">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#3a7bd5">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <button class="control-btn" id="recenter">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#3a7bd5">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
        </button>
        <button class="control-btn" id="move-right">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#3a7bd5">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        <button class="control-btn" id="move-down">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#3a7bd5">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>
      
      <div id="compass">
        <svg id="compass-needle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path fill="#E53935" d="M12 2L8 12H16L12 2Z" />
          <path fill="#3F51B5" d="M12 22L16 12H8L12 22Z" />
        </svg>
      </div>
    </div>
  </div>

  <script>
    let map, userMarker, parkingSpot, userLocation;
    let carLength = 4.5; // metros
    let carWidth = 2.0; // metros
    let heading = 0;
    let watchId;
    
    // Constantes para conversão de metros para coordenadas
    const METERS_TO_LAT = 0.000009;
    const METERS_TO_LNG = 0.000011;
    
    // Inicializa o mapa quando a página carrega
    function initApp() {
      // Configura os listeners de eventos para os botões
      document.getElementById('apply-dimensions').addEventListener('click', updateCarDimensions);
      document.getElementById('move-up').addEventListener('click', () => moveSpot(0, 1));
      document.getElementById('move-down').addEventListener('click', () => moveSpot(0, -1));
      document.getElementById('move-left').addEventListener('click', () => moveSpot(-1, 0));
      document.getElementById('move-right').addEventListener('click', () => moveSpot(1, 0));
      document.getElementById('recenter').addEventListener('click', recenterMap);
      
      const infoPanel = document.getElementById('info-panel');
      const infoToggle = document.getElementById('info-toggle');
      
      infoToggle.addEventListener('click', () => {
        infoPanel.classList.toggle('hidden');
        infoToggle.classList.toggle('visible');
      });
      
      // Inicia o mapa se a geolocalização estiver disponível
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(initMap, handleLocationError);
        
        // Observa mudanças na posição do usuário
        watchId = navigator.geolocation.watchPosition(updatePosition, handleLocationError, {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 5000
        });
      } else {
        alert("Geolocalização não é suportada pelo seu navegador.");
      }
    }
    
    // Inicializa o mapa com a posição do usuário
    function initMap(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      userLocation = { lat, lng };
      
      // Cria o mapa
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 20,
        center: userLocation,
        mapTypeId: 'satellite',
        tilt: 0,
        disableDefaultUI: true,
        gestureHandling: 'greedy'
      });
      
      // Cria o marcador do usuário
      userMarker = new google.maps.Marker({
        position: userLocation,
        map: map,
        title: "Sua posição",
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 8,
          fillColor: "#3a7bd5",
          fillOpacity: 1,
          strokeWeight: 2,
          strokeColor: "#FFFFFF"
        }
      });
      
      // Cria a vaga de estacionamento
      createParkingSpot(userLocation);
      
      // Adiciona um listener para atualizar a bússola quando o mapa muda
      map.addListener('heading_changed', () => {
        updateCompass(map.getHeading());
      });
    }
    
    // Cria a vaga de estacionamento
    function createParkingSpot(location) {
      // Calcula as dimensões da vaga em coordenadas
      const halfWidth = (carWidth / 2) * METERS_TO_LAT;
      const halfLength = (carLength / 2) * METERS_TO_LNG;
      
      const bounds = {
        north: location.lat + halfWidth,
        south: location.lat - halfWidth,
        east: location.lng + halfLength,
        west: location.lng - halfLength
      };
      
      // Cria o retângulo da vaga
      parkingSpot = new google.maps.Rectangle({
        strokeColor: "#4CAF50",
        strokeOpacity: 0.9,
        strokeWeight: 2,
        fillColor: "#4CAF50",
        fillOpacity: 0.3,
        map: map,
        bounds: bounds
      });
      
      // Adiciona marcadores nas extremidades da vaga para melhor visualização
      addParkingMarkers(bounds);
    }
    
    // Adiciona marcadores nas extremidades da vaga
    function addParkingMarkers(bounds) {
      const corners = [
        { lat: bounds.north, lng: bounds.east },
        { lat: bounds.north, lng: bounds.west },
        { lat: bounds.south, lng: bounds.east },
        { lat: bounds.south, lng: bounds.west }
      ];
      
      corners.forEach(corner => {
        new google.maps.Marker({
          position: corner,
          map: map,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 4,
            fillColor: "#4CAF50",
            fillOpacity: 1,
            strokeWeight: 1,
            strokeColor: "#FFFFFF"
          }
        });
      });
    }
    
    // Atualiza a posição do usuário
    function updatePosition(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      userLocation = { lat, lng };
      
      // Atualiza o marcador do usuário
      if (userMarker) {
        userMarker.setPosition(userLocation);
      }
      
      // Atualiza a bússola se o dispositivo suportar
      if (position.coords.heading !== null) {
        heading = position.coords.heading;
        updateCompass(heading);
      }
      
      // Verifica o alinhamento com a vaga
      checkAlignment();
    }
    
    // Move a vaga de estacionamento
    function moveSpot(x, y) {
      if (!parkingSpot) return;
      
      const bounds = parkingSpot.getBounds();
      const center = {
        lat: (bounds.getNorthEast().lat() + bounds.getSouthWest().lat()) / 2,
        lng: (bounds.getNorthEast().lng() + bounds.getSouthWest().lng()) / 2
      };
      
      // Calcula o deslocamento (0.5 metros por clique)
      const latOffset = y * 0.5 * METERS_TO_LAT;
      const lngOffset = x * 0.5 * METERS_TO_LNG;
      
      const newCenter = {
        lat: center.lat + latOffset,
        lng: center.lng + lngOffset
      };
      
      // Recria a vaga na nova posição
      parkingSpot.setMap(null);
      createParkingSpot(newCenter);
      
      // Verifica o alinhamento
      checkAlignment();
    }
    
    // Atualiza as dimensões do carro
    function updateCarDimensions() {
      const lengthInput = document.getElementById('car-length');
      const widthInput = document.getElementById('car-width');
      
      const newLength = parseFloat(lengthInput.value);
      const newWidth = parseFloat(widthInput.value);
      
      // Valida os valores
      if (isNaN(newLength) || isNaN(newWidth) || newLength < 2 || newWidth < 1) {
        alert("Por favor, insira dimensões válidas.");
        return;
      }
      
      carLength = newLength;
      carWidth = newWidth;
      
      // Recria a vaga com as novas dimensões
      if (parkingSpot) {
        const bounds = parkingSpot.getBounds();
        const center = {
          lat: (bounds.getNorthEast().lat() + bounds.getSouthWest().lat()) / 2,
          lng: (bounds.getNorthEast().lng() + bounds.getSouthWest().lng()) / 2
        };
        
        parkingSpot.setMap(null);
        createParkingSpot(center);
        
        // Verifica o alinhamento
        checkAlignment();
      }
    }
    
    // Recentra o mapa na posição do usuário
    function recenterMap() {
      if (map && userLocation) {
        map.setCenter(userLocation);
      }
    }
    
    // Verifica o alinhamento do usuário com a vaga
    function checkAlignment() {
      if (!parkingSpot || !userLocation) return;
      
      const bounds = parkingSpot.getBounds();
      const center = {
        lat: (bounds.getNorthEast().lat() + bounds.getSouthWest().lat()) / 2,
        lng: (bounds.getNorthEast().lng() + bounds.getSouthWest().lng()) / 2
      };
      
      // Calcula a distância entre o usuário e o centro da vaga
      const distance = getDistance(userLocation, center);
      
      // Atualiza o indicador de status
      const statusIndicator = document.querySelector('.status-indicator');
      const statusText = document.querySelector('.status-text');
      
      statusIndicator.className = 'status-indicator';
      
      if (distance < 1) {
        statusIndicator.classList.add('status-perfect');
        statusText.textContent = 'Posicionamento perfeito!';
      } else if (distance < 2) {
        statusIndicator.classList.add('status-good');
        statusText.textContent = 'Bom posicionamento';
      } else if (distance < 4) {
        statusIndicator.classList.add('status-adjust');
        statusText.textContent = 'Ajuste a posição';
      } else {
        statusIndicator.classList.add('status-warning');
        statusText.textContent = 'Muito distante da vaga';
      }
    }
    
    // Calcula a distância entre dois pontos em metros
    function getDistance(p1, p2) {
      const R = 6371e3; // raio da Terra em metros
      const φ1 = p1.lat * Math.PI / 180;
      const φ2 = p2.lat * Math.PI / 180;
      const Δφ = (p2.lat - p1.lat) * Math.PI / 180;
      const Δλ = (p2.lng - p1.lng) * Math.PI / 180;
      
      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      
      return R * c;
    }
    
    // Atualiza a bússola
    function updateCompass(degrees) {
      const needle = document.getElementById('compass-needle');
      if (needle) {
        needle.style.transform = `rotate(${degrees}deg)`;
      }
    }
    
    // Trata erros de geolocalização
    function handleLocationError(error) {
      let message;
      
      switch(error.code) {
        case error.PERMISSION_DENIED:
          message = "Usuário negou a solicitação de geolocalização.";
          break;
        case error.POSITION_UNAVAILABLE:
          message = "Informações de localização indisponíveis.";
          break;
        case error.TIMEOUT:
          message = "Tempo esgotado ao solicitar localização.";
          break;
        case error.UNKNOWN_ERROR:
          message = "Ocorreu um erro desconhecido.";
          break;
      }
      
      alert(`Erro de geolocalização: ${message}`);
    }
    
    // Limpa o observador de posição quando a página é fechada
    window.addEventListener('beforeunload', () => {
      if (watchId) {
        navigator.geolocation.clearWatch(watchId);
      }
    });
    
    // Inicia o aplicativo quando a página carrega
    window.addEventListener('load', initApp);
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964a0fb6236c3183',t:'MTc1MzQyOTc3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
